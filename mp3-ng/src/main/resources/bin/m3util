#!/bin/bash

# Go recursively up to find the mountpoint
# $1 - path
function findmountpoint()
{
  mountpoint $1 > /dev/null
  if [ "$?" != 0 ]
  then
    findmountpoint $(dirname $1)
  else
    mp=$1
  fi
}

folder="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

if [ -z "$M3_LIBRARY_HOME" ]
then
  findmountpoint $folder
fi

export M3_LIBRARY_HOME=$mp

script=$(basename $0)

echo "### Assuming $M3_LIBRARY_HOME as media library root!"

source $M3_LIBRARY_HOME/tools/etc/$script.conf

if [ -z "$JAVA_HOME" ]
then
  export JAVA_HOME=$M3_LIBRARY_HOME/tools/lib/jre1.7.0_05
  export PATH=$PATH:$JAVA_HOME/bin
  export LD_LIBRARY_PATH=$PATH:$JAVA_HOME/lib
fi

java -DM3_LIBRARY_HOME=$M3_LIBRARY_HOME -jar $M3_LIBRARY_HOME/tools/lib/m3util/mp3-ng-1.0.0-SNAPSHOT-jar-with-dependencies.jar $*
